# On avance le pointeur d'un cran dans la direction du regard du joueur
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..}] run tp @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..}] ^ ^ ^1

# On incremente le compteur de déplacement
scoreboard players add @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..}] ray_counter 1

# On execute les commandes de detection/ecriture
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up3] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~3 ~\"}}", Text2: "{\"text\":\"^\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down3] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~-3 ~\"}}", Text2: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"V\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up4] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~4 ~\"}}", Text2: "{\"text\":\"^\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down4] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~-4 ~\"}}", Text2: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"V\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up5] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~5 ~\"}}", Text2: "{\"text\":\"^\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down5] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~-5 ~\"}}", Text2: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"V\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up6] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~6 ~\"}}", Text2: "{\"text\":\"^\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down6] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~-6 ~\"}}", Text2: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"V\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up7] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~7 ~\"}}", Text2: "{\"text\":\"^\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down7] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~-7 ~\"}}", Text2: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"V\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up8] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~8 ~\"}}", Text2: "{\"text\":\"^\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down8] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~-8 ~\"}}", Text2: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"V\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up9] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~9 ~\"}}", Text2: "{\"text\":\"^\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down9] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: "{\"text\":\"\",\"color\":\"dark_red\",\"bold\":\"true\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"/execute at @p[distance=..2] run tp @p[distance=..2] ~ ~-9 ~\"}}", Text2: "{\"text\":\"|\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text3: "{\"text\":\"V\",\"color\":\"dark_red\",\"bold\":\"true\"}", Text4: "{\"text\":\"\",\"color\":\"red\"}", id: "Sign"}
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=UpX] if block ~ ~.4 ~ #minecraft:signs run data merge block ~ ~1 ~ {Text1: '{"text":"","clickEvent":{"action":"run_command","value":"tag @p add wantlift"}}', Text2: '{"text":"^","clickEvent":{"action":"run_command","value":"summon minecraft:armor_stand ~ ~ ~ {NoGravity:1b,Invisible:1b,Tags:[\\"uplift\\"]}"},"bold":true,"color":"#0801FF"}', Text3: '{"text":"|","bold":true,"color":"#0801FF"}'}

# Annonce de l'écriture de la pancarte
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up3] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"3 blocs vers le haut","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down3] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"3 blocs vers le bas","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up4] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"4 blocs vers le haut","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down4] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"4 blocs vers le bas","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up5] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"5 blocs vers le haut","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down5] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"5 blocs vers le bas","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up6] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"6 blocs vers le haut","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down6] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"6 blocs vers le bas","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up7] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"7 blocs vers le haut","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down7] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"7 blocs vers le bas","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up8] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"8 blocs vers le haut","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down8] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"8 blocs vers le bas","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Up9] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"9 blocs vers le haut","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=Down9] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"9 blocs vers le bas","color":"gold"},{"text":"\n/!\\ ","color":"red"},{"text":"Assurez vous que la zone de destination est accessible ","color":"gold"}]
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=UpX] if block ~ ~.4 ~ #minecraft:signs run tellraw @p ["",{"text":"Ascenseur posé: ","color":"dark_green"},{"text":"X blocs vers le haut\n","color":"gold"},{"text":"/!\\ ","color":"red"},{"text":"Assurez vous d'avoir un bloc de pierre sculptée quelque part au dessus de cette pancarte. ","color":"gold"}]

# Si on a croisé une pancarte on supprime un exemplaire du livre.
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=!] if block ~ ~.4 ~ #minecraft:signs run clear @p minecraft:written_book{title: "Livre des ascenseurs"} 1

# On détruit les pancartes qui ont atteint la limite de distance ou qui ont rencontré une pancarte
execute at @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=!] if block ~ ~.4 ~ #minecraft:signs run scoreboard players set @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=1..},tag=!] ray_counter 5
execute if entity @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=4}] run tellraw @p ["",{"text":"Pas de pancarte trouvée, aucun ascenseur posé.\nPancarte trop proche ou trop éloignée?\nCliquez sur le bloc portant la pancarte.","color":"red"}]

kill @e[type=minecraft:armor_stand,sort=nearest,limit=1,scores={ray_counter=4..}]